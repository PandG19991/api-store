# 管理员操作测试场景

## 场景1: 管理员登录与权限验证

### 测试步骤

1. **正确登录**
   - 访问 `/admin/login`
   - 输入正确的用户名: `admin`
   - 输入正确的密码: `admin123`
   - 点击登录

   **预期结果**: ✅ 成功登录,跳转到仪表盘

2. **错误密码登录**
   - 输入正确的用户名: `admin`
   - 输入错误的密码: `wrongpassword`
   - 点击登录

   **预期结果**: ✅ 显示"用户名或密码错误"

3. **未登录访问保护页面**
   - 未登录状态直接访问 `/admin/products`

   **预期结果**: ✅ 自动跳转到登录页面

4. **登出功能**
   - 已登录状态点击"退出登录"

   **预期结果**: ✅ 跳转到登录页面,token被清除

---

## 场景2: 产品管理操作

### 2.1 查看产品列表

**测试步骤**:
1. 登录后访问产品管理页面
2. 验证产品列表显示

**预期结果**:
- ✅ 显示所有产品
- ✅ 显示产品名称、价格、状态、库存
- ✅ 分页功能正常

### 2.2 创建新产品

**测试步骤**:
1. 点击"新建产品"按钮
2. 填写产品信息:
   - 名称: `Visual Studio 2022`
   - 中文描述: `专业开发工具`
   - 英文描述: `Professional Development Tool`
   - 价格: ¥499
3. 点击"保存"

**预期结果**:
- ✅ 产品创建成功
- ✅ 产品列表中显示新产品
- ✅ 数据库中正确保存

### 2.3 编辑产品

**测试步骤**:
1. 选择一个产品点击"编辑"
2. 修改产品名称
3. 修改价格
4. 点击"保存"

**预期结果**:
- ✅ 产品信息更新成功
- ✅ 列表显示更新后的信息

### 2.4 禁用/启用产品

**测试步骤**:
1. 点击产品的状态切换按钮
2. 将状态从"启用"改为"禁用"

**预期结果**:
- ✅ 产品状态更新
- ✅ 前台不再显示该产品
- ✅ 后台仍可管理

### 2.5 删除产品

**测试步骤**:
1. 选择一个无订单的产品
2. 点击"删除"按钮
3. 确认删除

**预期结果**:
- ✅ 产品删除成功
- ✅ 关联的密钥一并删除
- ✅ 有订单的产品无法删除(软删除)

---

## 场景3: 密钥管理操作

### 3.1 查看密钥列表

**测试步骤**:
1. 访问密钥管理页面
2. 查看密钥列表
3. 使用产品筛选

**预期结果**:
- ✅ 显示所有密钥
- ✅ 显示密钥状态(可用/已售出/已作废)
- ✅ 筛选功能正常
- ✅ 分页功能正常

### 3.2 批量导入密钥

**测试步骤**:
1. 点击"批量导入"按钮
2. 选择产品: Windows 11 Pro
3. 输入密钥列表(每行一个):
   ```
   XXXXX-XXXXX-XXXXX-XXXXX
   YYYYY-YYYYY-YYYYY-YYYYY
   ZZZZZ-ZZZZZ-ZZZZZ-ZZZZZ
   ```
4. 点击"导入"

**预期结果**:
- ✅ 密钥导入成功
- ✅ 显示导入成功数量
- ✅ 重复密钥被识别并跳过
- ✅ 密钥状态为"可用"

### 3.3 作废密钥

**测试步骤**:
1. 选择一个"可用"状态的密钥
2. 点击"作废"按钮
3. 输入作废原因: `测试作废`
4. 确认作废

**预期结果**:
- ✅ 密钥状态更新为"已作废"
- ✅ 记录作废时间和原因
- ✅ 该密钥不再可用于新订单

### 3.4 删除密钥

**测试步骤**:
1. 选择一个"可用"状态的密钥
2. 点击"删除"按钮
3. 确认删除

**预期结果**:
- ✅ 只能删除"可用"状态的密钥
- ✅ 已售出的密钥无法删除
- ✅ 删除成功后从列表移除

### 3.5 查看密钥统计

**预期结果**:
- ✅ 显示总密钥数
- ✅ 显示可用密钥数
- ✅ 显示已售出密钥数
- ✅ 显示已作废密钥数
- ✅ 数量统计准确

---

## 场景4: 订单管理操作

### 4.1 查看订单列表

**测试步骤**:
1. 访问订单管理页面
2. 查看所有订单

**预期结果**:
- ✅ 显示所有订单
- ✅ 显示订单号、邮箱、金额、状态、时间
- ✅ 分页功能正常

### 4.2 搜索订单

**测试步骤**:
1. 在搜索框输入订单号
2. 点击搜索

**预期结果**:
- ✅ 显示匹配的订单
- ✅ 支持订单号搜索
- ✅ 支持邮箱搜索

### 4.3 筛选订单

**测试步骤**:
1. 选择状态筛选: "待支付"
2. 查看结果

**预期结果**:
- ✅ 只显示待支付订单
- ✅ 支持多种状态筛选
- ✅ 可组合搜索和筛选

### 4.4 查看订单详情

**测试步骤**:
1. 点击某个订单的"查看"按钮
2. 查看订单详情对话框

**预期结果**:
- ✅ 显示完整订单信息
- ✅ 显示订单项目列表
- ✅ 显示分配的密钥(已完成订单)
- ✅ 显示支付信息

### 4.5 手动完成订单

**测试步骤**:
1. 选择一个"待支付"订单
2. 点击"手动完成"按钮
3. 确认操作

**预期结果**:
- ✅ 订单状态更新为"已完成"
- ✅ 自动分配密钥
- ✅ 发送邮件通知用户

### 4.6 取消订单

**测试步骤**:
1. 选择一个"待支付"订单
2. 点击"取消"按钮
3. 确认取消

**预期结果**:
- ✅ 订单状态更新为"已取消"
- ✅ 未分配的密钥保持可用
- ✅ 库存恢复

---

## 场景5: 系统设置操作

### 5.1 修改站点配置

**测试步骤**:
1. 访问系统设置页面
2. 修改站点名称为: `新名称`
3. 点击"保存设置"

**预期结果**:
- ✅ 设置保存成功
- ✅ 前台显示新站点名称

### 5.2 配置支付方式

**测试步骤**:
1. 切换支付宝状态为"启用"
2. 保存设置

**预期结果**:
- ✅ 支付方式配置更新
- ✅ 前台显示对应支付方式

### 5.3 设置库存预警阈值

**测试步骤**:
1. 修改预警阈值为: 10
2. 保存设置

**预期结果**:
- ✅ 阈值更新成功
- ✅ 低于阈值的产品触发预警

---

## 场景6: 仪表盘数据验证

### 测试步骤

1. **验证统计数据准确性**
   - 访问仪表盘
   - 对比以下数据:
     - 总收入 vs 数据库已完成订单金额总和
     - 订单总数 vs 数据库订单总数
     - 产品总数 vs 数据库产品总数
     - 密钥库存 vs 数据库可用密钥总数

**预期结果**:
- ✅ 所有统计数据与数据库一致
- ✅ 实时更新(创建订单后数据变化)

---

## 性能测试场景

### 1. 大量数据加载

**测试步骤**:
1. 导入1000个密钥
2. 访问密钥列表页面
3. 测试分页和筛选性能

**预期结果**:
- ✅ 页面加载时间 < 2秒
- ✅ 分页切换流畅
- ✅ 筛选响应快速

### 2. 并发操作

**测试步骤**:
1. 多个管理员同时编辑同一产品
2. 观察数据一致性

**预期结果**:
- ✅ 数据不丢失
- ✅ 最后保存的数据生效
- ✅ 无数据冲突

---

## 安全测试场景

### 1. SQL注入防护

**测试步骤**:
1. 在搜索框输入: `' OR '1'='1`
2. 提交搜索

**预期结果**:
- ✅ 不返回所有数据
- ✅ 输入被正确转义

### 2. XSS防护

**测试步骤**:
1. 在产品名称输入: `<script>alert('xss')</script>`
2. 保存并查看

**预期结果**:
- ✅ 脚本不执行
- ✅ 内容被转义显示

### 3. CSRF防护

**测试步骤**:
1. 尝试跨站请求修改数据

**预期结果**:
- ✅ 请求被拒绝
- ✅ Token验证生效

---

## 测试检查清单

### 功能完整性
- [ ] 所有CRUD操作正常
- [ ] 搜索和筛选功能正常
- [ ] 分页功能正常
- [ ] 批量操作功能正常

### 数据完整性
- [ ] 数据保存准确
- [ ] 关联关系正确
- [ ] 级联删除正确
- [ ] 事务处理正确

### 用户体验
- [ ] 错误提示友好
- [ ] 成功提示明确
- [ ] 加载状态显示
- [ ] 响应速度快

### 安全性
- [ ] 权限控制有效
- [ ] 输入验证严格
- [ ] 敏感数据加密
- [ ] 日志记录完整
