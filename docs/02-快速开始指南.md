# å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨æœ¬åœ°ç¯å¢ƒå¿«é€Ÿå¯åŠ¨è™šæ‹Ÿäº§å“é”€å”®å¹³å°ã€‚

---

## å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…ï¼š

- **Node.js** >= 20.0.0
- **PostgreSQL** >= 15.0
- **Redis** >= 7.0
- **npm** æˆ– **pnpm**

---

## ç¬¬ä¸€æ­¥ï¼šå®‰è£…æ•°æ®åº“

### å®‰è£… PostgreSQL

**Windows:**
```bash
# ä¸‹è½½å¹¶å®‰è£… PostgreSQL
# https://www.postgresql.org/download/windows/

# æˆ–ä½¿ç”¨ Chocolatey
choco install postgresql

# å¯åŠ¨æœåŠ¡
pg_ctl start
```

**macOS:**
```bash
brew install postgresql@15
brew services start postgresql@15
```

**Linux:**
```bash
sudo apt-get install postgresql-15
sudo systemctl start postgresql
```

### åˆ›å»ºæ•°æ®åº“

```bash
# ç™»å½• PostgreSQL
psql -U postgres

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE license_store;

# åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ (å¯é€‰)
CREATE USER licensestore_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE license_store TO licensestore_user;

# é€€å‡º
\q
```

---

### å®‰è£… Redis

**Windows:**
```bash
# ä½¿ç”¨ WSL æˆ–ä¸‹è½½ Windows ç‰ˆæœ¬
# https://github.com/microsoftarchive/redis/releases

# æˆ–ä½¿ç”¨ Chocolatey
choco install redis-64
redis-server
```

**macOS:**
```bash
brew install redis
brew services start redis
```

**Linux:**
```bash
sudo apt-get install redis-server
sudo systemctl start redis
```

---

## ç¬¬äºŒæ­¥ï¼šé…ç½®åç«¯

### 1. è¿›å…¥åç«¯ç›®å½•

```bash
cd backend
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env
```

### 4. ç¼–è¾‘ .env æ–‡ä»¶

**Windows (ä½¿ç”¨è®°äº‹æœ¬):**
```bash
notepad .env
```

**å¿…é¡»é…ç½®çš„ç¯å¢ƒå˜é‡:**

```env
# æ•°æ®åº“è¿æ¥ (ä¿®æ”¹ä¸ºæ‚¨çš„å®é™…é…ç½®)
DATABASE_URL="postgresql://postgres:your_password@localhost:5432/license_store"

# Redis è¿æ¥
REDIS_URL="redis://localhost:6379"

# JWT å¯†é’¥ (ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²)
JWT_SECRET="your-super-secret-jwt-key-change-this-in-production"

# åŠ å¯†å¯†é’¥ (è¿è¡Œä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆ)
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY="your-32-byte-hex-key-here"
```

**ç”ŸæˆåŠ å¯†å¯†é’¥:**

```bash
# æ–¹æ³•1: ä½¿ç”¨ Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# æ–¹æ³•2: ä½¿ç”¨ OpenSSL
openssl rand -hex 32
```

å°†ç”Ÿæˆçš„å¯†é’¥å¤åˆ¶åˆ° `.env` æ–‡ä»¶çš„ `ENCRYPTION_KEY` å­—æ®µã€‚

---

## ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“

### 1. ç”Ÿæˆ Prisma Client

```bash
npm run db:generate
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
npm run db:migrate
```

è¿™å°†åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„æ•°æ®è¡¨ã€‚

### 3. (å¯é€‰) å¡«å……æµ‹è¯•æ•°æ®

```bash
npm run db:seed
```

---

## ç¬¬å››æ­¥ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡º:

```
âœ… Database connected successfully
âœ… Redis connected successfully

ğŸš€ Server is running!
ğŸ“ Local:   http://localhost:3000
ğŸŒ Network: http://0.0.0.0:3000
ğŸ“ Environment: development

Press Ctrl+C to stop the server
```

---

## ç¬¬äº”æ­¥ï¼šæµ‹è¯• API

### æ–¹æ³• 1: ä½¿ç”¨æµè§ˆå™¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®:
```
http://localhost:3000/health
```

æ‚¨åº”è¯¥çœ‹åˆ°:
```json
{
  "success": true,
  "message": "Server is running",
  "timestamp": "2025-10-16T...",
  "uptime": 5.123
}
```

### æ–¹æ³• 2: ä½¿ç”¨ cURL

```bash
curl http://localhost:3000/health
```

### æ–¹æ³• 3: ä½¿ç”¨ Postman æˆ– Insomnia

å¯¼å…¥ä»¥ä¸‹è¯·æ±‚:
- URL: `http://localhost:3000/health`
- Method: `GET`

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: æ•°æ®åº“è¿æ¥å¤±è´¥

```
âŒ Database connection error
```

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥ PostgreSQL æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. éªŒè¯ `.env` ä¸­çš„ `DATABASE_URL` æ˜¯å¦æ­£ç¡®
3. æµ‹è¯•æ•°æ®åº“è¿æ¥:
   ```bash
   psql -U postgres -d license_store
   ```

---

### é—®é¢˜ 2: Redis è¿æ¥å¤±è´¥

```
âŒ Redis connection error
```

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥ Redis æ˜¯å¦æ­£åœ¨è¿è¡Œ:
   ```bash
   redis-cli ping
   # åº”è¯¥è¿”å› PONG
   ```
2. éªŒè¯ `.env` ä¸­çš„ `REDIS_URL`

---

### é—®é¢˜ 3: ç«¯å£å·²è¢«å ç”¨

```
Error: listen EADDRINUSE: address already in use :::3000
```

**è§£å†³æ–¹æ¡ˆ:**
1. ä¿®æ”¹ `.env` ä¸­çš„ `PORT`:
   ```env
   PORT=3001
   ```
2. æˆ–å…³é—­å ç”¨ç«¯å£çš„ç¨‹åº

---

### é—®é¢˜ 4: Prisma è¿ç§»å¤±è´¥

```
Error: P1001: Can't reach database server
```

**è§£å†³æ–¹æ¡ˆ:**
1. ç¡®ä¿æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
3. é‡æ–°è¿è¡Œè¿ç§»:
   ```bash
   npm run db:migrate
   ```

---

## ä¸‹ä¸€æ­¥

- [ ] æŸ¥çœ‹ [API æ¥å£æ–‡æ¡£](./03-APIæ¥å£æ–‡æ¡£.md)
- [ ] å®ç°ä¸šåŠ¡é€»è¾‘æœåŠ¡
- [ ] å¼€å‘å‰ç«¯é¡µé¢

---

## æœ‰ç”¨çš„å‘½ä»¤

### æ•°æ®åº“ç›¸å…³

```bash
# æŸ¥çœ‹æ•°æ®åº“
npm run db:studio

# é‡ç½®æ•°æ®åº“ (å±é™©! ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®)
npx prisma migrate reset

# åˆ›å»ºæ–°çš„è¿ç§»
npx prisma migrate dev --name your_migration_name
```

### å¼€å‘ç›¸å…³

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (è‡ªåŠ¨é‡å¯)
npm run dev

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log  # (å¦‚æœé…ç½®äº†æ—¥å¿—æ–‡ä»¶)
```

---

**ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼** ğŸš€
