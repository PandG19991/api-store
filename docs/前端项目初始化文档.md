# 前端项目初始化文档

## 概述

- **初始化时间**: 2025-10-16
- **技术栈**: Next.js 14 + React 18 + TypeScript + Tailwind CSS + shadcn/ui
- **状态管理**: React Query + Zustand
- **开发服务器**: http://localhost:3000
- **状态**: ✅ 初始化完成，服务器正常运行

## 项目结构

```
frontend/
├── src/
│   ├── app/                    # Next.js App Router 页面
│   │   ├── layout.tsx         # 根布局 (集成 React Query Provider)
│   │   ├── page.tsx           # 首页
│   │   └── globals.css        # 全局样式 (含 shadcn 变量)
│   ├── lib/                   # 核心库
│   │   ├── api/               # API 客户端和服务
│   │   │   ├── client.ts      # Axios 客户端配置
│   │   │   ├── products.ts    # 产品 API
│   │   │   ├── orders.ts      # 订单 API
│   │   │   └── admin.ts       # 管理后台 API
│   │   ├── hooks/             # 自定义 React Hooks
│   │   │   ├── useProducts.ts # 产品相关 hooks
│   │   │   ├── useOrders.ts   # 订单相关 hooks
│   │   │   └── useAdmin.ts    # 管理后台 hooks
│   │   ├── types/             # TypeScript 类型定义
│   │   │   └── index.ts       # 所有类型
│   │   ├── providers/         # 全局 Provider
│   │   │   └── react-query-provider.tsx
│   │   ├── store/             # Zustand 状态管理 (待创建)
│   │   └── utils.ts           # shadcn 工具函数
│   └── components/            # 组件目录
│       ├── ui/                # shadcn UI 组件 (待添加)
│       ├── store/             # 用户商店组件 (待创建)
│       └── admin/             # 管理后台组件 (待创建)
├── public/                    # 静态资源
├── .env.local                 # 环境变量
├── components.json            # shadcn 配置
├── package.json               # 依赖管理 (365 packages)
├── tsconfig.json              # TypeScript 配置
├── tailwind.config.ts         # Tailwind CSS 配置
├── next.config.ts             # Next.js 配置
└── eslint.config.mjs          # ESLint 配置
```

## 已安装依赖

### 核心依赖 (共 365 packages)

```json
{
  "dependencies": {
    "next": "15.5.5",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",

    // 数据获取和状态管理
    "@tanstack/react-query": "^5.62.18",
    "axios": "^1.7.9",
    "zustand": "^5.0.3",

    // 表单和验证
    "react-hook-form": "^7.54.2",
    "@hookform/resolvers": "^3.9.1",
    "zod": "^3.24.1",

    // 国际化
    "next-intl": "^3.28.6",

    // UI 组件
    "tailwindcss": "^3.4.17",
    "clsx": "^2.1.1",
    "tailwind-merge": "^2.6.0",
    "class-variance-authority": "^0.7.1",
    "@radix-ui/react-*": "多个包"
  },
  "devDependencies": {
    "@tanstack/react-query-devtools": "^5.62.18",
    "typescript": "^5",
    "eslint": "^9",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19"
  }
}
```

## 配置文件详解

### 1. `.env.local` - 环境变量

```env
# API Configuration
NEXT_PUBLIC_API_URL=http://localhost:3000
NEXT_PUBLIC_API_BASE_PATH=/api

# App Configuration
NEXT_PUBLIC_APP_NAME=虚拟产品销售平台
NEXT_PUBLIC_DEFAULT_LANG=zh

# Payment Configuration
NEXT_PUBLIC_ALIPAY_ENABLED=true
NEXT_PUBLIC_WECHAT_PAY_ENABLED=true

# Admin Configuration
NEXT_PUBLIC_ADMIN_PATH=/admin
```

### 2. `next.config.ts` - Next.js 配置

```typescript
const nextConfig: NextConfig = {
  // API 代理配置（开发环境）
  async rewrites() {
    return [
      {
        source: '/api/:path*',
        destination: 'http://localhost:3000/api/:path*',
      },
    ];
  },

  // 图片优化配置
  images: {
    domains: ['localhost'],
  },

  // 开启严格模式
  reactStrictMode: true,
};
```

**注意**: App Router 不支持旧版的 `i18n` 配置，国际化需使用 `next-intl` 等第三方库。

### 3. `components.json` - shadcn/ui 配置

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/app/globals.css",
    "baseColor": "zinc",
    "cssVariables": true
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
```

## 核心功能实现

### API 客户端 (`lib/api/client.ts`)

**特性**:
- Axios 实例配置
- 请求/响应拦截器
- 自动 Token 管理
- 错误处理
- 401 自动跳转

```typescript
// 使用示例
import api from '@/lib/api/client';

const data = await api.get('/products');
const result = await api.post('/orders', orderData);
```

### React Query 配置 (`lib/providers/react-query-provider.tsx`)

**配置**:
- 数据缓存 10 分钟
- 新鲜度保持 5 分钟
- 失败重试 1 次
- 开发环境显示 DevTools

```typescript
// 在 layout.tsx 中使用
<ReactQueryProvider>
  {children}
</ReactQueryProvider>
```

### 自定义 Hooks

**产品相关** (`lib/hooks/useProducts.ts`):
```typescript
import { useProducts, useProduct } from '@/lib/hooks/useProducts';

// 组件中使用
const { data: products, isLoading } = useProducts('zh');
const { data: product } = useProduct(productId, 'zh');
```

**订单相关** (`lib/hooks/useOrders.ts`):
```typescript
import { useCreateOrder } from '@/lib/hooks/useOrders';

const createOrder = useCreateOrder();
createOrder.mutate(orderData);
```

**管理后台** (`lib/hooks/useAdmin.ts`):
```typescript
import { useAdminLogin, useDashboardStats } from '@/lib/hooks/useAdmin';

const login = useAdminLogin();
const { data: stats } = useDashboardStats();
```

### TypeScript 类型系统 (`lib/types/index.ts`)

**已定义类型**:
- `ApiResponse<T>` - 通用 API 响应
- `Product` - 产品
- `Order` - 订单
- `LicenseKey` - 密钥
- `DashboardStats` - 仪表盘统计
- `PaginatedResponse<T>` - 分页响应
- 等 20+ 类型定义

## 启动和开发

### 启动开发服务器

```bash
cd frontend
npm run dev
```

服务器将在 http://localhost:3000 启动

### 构建生产版本

```bash
npm run build
npm start
```

### 运行 ESLint

```bash
npm run lint
```

## shadcn/ui 组件使用

### 安装组件

```bash
# 进入前端目录
cd frontend

# 安装单个组件
npx shadcn@latest add button

# 安装多个组件
npx shadcn@latest add button input card dialog
```

### 使用组件

```tsx
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"

export default function MyComponent() {
  return (
    <div>
      <Input placeholder="输入内容" />
      <Button>提交</Button>
    </div>
  )
}
```

## 已知问题和解决方案

### 1. i18n 警告

**问题**:
```
⚠ i18n configuration in next.config.ts is unsupported in App Router.
```

**解决方案**:
已移除旧版 i18n 配置。App Router 应使用 `next-intl` 实现国际化。

### 2. API 代理

**说明**:
开发环境中，前端 `/api/*` 请求会被代理到后端 `http://localhost:3000/api/*`。

**注意**:
确保后端服务器正在运行在端口 3000。

## 下一步计划

根据项目规划，接下来的任务是：

### Task 21: 前端公共组件
- [ ] 安装 shadcn 基础组件 (Button, Input, Card, Dialog, etc.)
- [ ] 创建布局组件 (Header, Footer, Container)
- [ ] 创建加载状态组件
- [ ] 创建错误提示组件

### Task 22: 前端商品展示页
- [ ] 实现产品列表页面
- [ ] 实现产品详情页面
- [ ] 价格本地化显示
- [ ] 库存状态展示

### Task 23: 前端支付流程
- [ ] 实现支付弹窗组件
- [ ] 集成支付宝支付
- [ ] 集成微信支付
- [ ] 支付状态处理

## 性能数据

**服务器启动时间**: 2.5 秒
**包总数**: 365 个
**依赖大小**: ~250 MB (node_modules)

## 开发规范

### 1. 文件命名
- 组件文件: PascalCase (例如 `ProductCard.tsx`)
- 工具函数: camelCase (例如 `formatPrice.ts`)
- 类型文件: PascalCase (例如 `Product.types.ts`)

### 2. 导入顺序
```typescript
// 1. React 相关
import { useState } from 'react';

// 2. 第三方库
import { useQuery } from '@tanstack/react-query';

// 3. 内部导入
import { Button } from '@/components/ui/button';
import api from '@/lib/api/client';
import type { Product } from '@/lib/types';
```

### 3. 组件结构
```typescript
'use client'; // 需要时添加

import { ... } from '...';

// 类型定义
interface Props {
  ...
}

// 组件
export function Component({ ...props }: Props) {
  // 1. hooks
  // 2. 状态
  // 3. 副作用
  // 4. 事件处理函数
  // 5. 渲染逻辑

  return (
    ...
  );
}
```

## 参考链接

- [Next.js 文档](https://nextjs.org/docs)
- [React Query 文档](https://tanstack.com/query/latest)
- [shadcn/ui 文档](https://ui.shadcn.com/)
- [Tailwind CSS 文档](https://tailwindcss.com/docs)
- [TypeScript 文档](https://www.typescriptlang.org/docs/)

## 总结

前端项目已成功初始化，所有核心基础设施已搭建完成：
- ✅ Next.js 14 项目创建
- ✅ TypeScript 类型系统
- ✅ Tailwind CSS + shadcn/ui
- ✅ API 客户端和服务
- ✅ React Query 数据获取
- ✅ 自定义 Hooks 封装
- ✅ 环境变量配置
- ✅ 开发服务器运行正常

项目已准备好开始实现具体的页面和组件功能。
